[gd_scene load_steps=2 format=3 uid="uid://d0uk6nmmnjg0l"]

[sub_resource type="GDScript" id="GDScript_lgrss"]
script/source = "extends Parallax2D

@export var particle_count: int = 20
@export var spawn_area: Vector2 = Vector2(480, 270) # Default viewport size, adjust as needed
@export var base_color: Color = Color(1, 1, 1, 0.4) # Slightly transparent white

func _ready() -> void:
	# 1. Create a \"Large Glow\" Texture (Hollow Knight Style)
	# We use 64x64 to allow for a large, soft gradient falloff.
	var size = 64
	var radius = 30.0
	var center = Vector2(size / 2.0, size / 2.0)
	
	var img = Image.create(size, size, false, Image.FORMAT_RGBA8)
	
	for y in range(size):
		for x in range(size):
			var dist = center.distance_to(Vector2(x, y))
			if dist <= radius:
				# Calculate Alpha: Soft quadratic falloff
				# 1.0 at center, 0.0 at edge
				var alpha = pow(1.0 - (dist / radius), 2.5)
				img.set_pixel(x, y, Color(1, 1, 1, alpha))
	
	var tex = ImageTexture.create_from_image(img)
	
	# 2. Spawn Particles
	for i in range(particle_count):
		var p = Sprite2D.new()
		p.texture = tex
		p.modulate = base_color
		
		# Randomize Position & Scale
		p.position = Vector2(randf() * spawn_area.x, randf() * spawn_area.y)
		# Varied scale creates depth perception (0.5 to 1.5 times the 64px texture)
		p.scale = Vector2.ONE * randf_range(0.5, 1.5)
		
		add_child(p)
		
		# 3. Floating Animation
		_animate_particle(p)

func _animate_particle(p: Sprite2D) -> void:
	var tween = create_tween().set_loops()
	
	# Random sway parameters
	var move_offset = Vector2(randf_range(-4, 4), randf_range(-10, -20))
	var duration = randf_range(3.0, 6.0)
	
	# Bob up and down gently
	tween.tween_property(p, \"position\", p.position + move_offset, duration)\\
		.set_trans(Tween.TRANS_SINE).set_ease(Tween.EASE_IN_OUT)
	tween.tween_property(p, \"position\", p.position, duration)\\
		.set_trans(Tween.TRANS_SINE).set_ease(Tween.EASE_IN_OUT)
"

[node name="AmbientParticles" type="Parallax2D"]
script = SubResource("GDScript_lgrss")
